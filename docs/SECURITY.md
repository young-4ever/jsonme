# 安全指南

## 默认GitHub Token服务

JsonMe提供默认GitHub Token服务以提升用户体验，但我们非常重视安全问题。

### 🔒 安全措施

#### 1. 环境变量保护
- Token存储在环境变量中，不在源码中暴露
- 构建时注入，运行时读取
- 遵循最佳实践，使用`.env`文件管理

#### 2. 速率限制
- 每个IP地址每小时限制上传次数（默认10次）
- 本地存储追踪使用量，防止滥用
- 超出限制后自动引导用户使用自己的Token

#### 3. 最小权限原则
- Token仅具有`gist`权限
- 无法访问用户仓库、个人信息或其他敏感数据
- 仅能创建公开的Gist

#### 4. 使用监控
- 建议定期监控Token使用量
- 设置GitHub API使用警报
- 及时发现异常使用

#### 5. 一次性Token安全
- 分享链接采用时间戳+随机数+签名验证
- 24小时自动过期机制
- 使用后立即失效，防止重放攻击
- 本地存储记录已使用Token，避免重复使用

### 🎯 推荐配置

#### 环境变量设置
```bash
# .env (不要提交到版本控制)
VITE_DEFAULT_GITHUB_TOKEN=ghp_your_token_here
VITE_DEFAULT_TOKEN_RATE_LIMIT=10
```

#### GitHub Token权限
创建Token时只需勾选：
- ✅ `gist` - 创建和管理Gist

不要勾选其他权限，如：
- ❌ `repo` - 仓库访问
- ❌ `user` - 用户信息
- ❌ `admin:*` - 管理权限

### ⚠️ 安全风险

#### 潜在风险
1. **Token暴露**: 前端代码中的Token对所有人可见
2. **滥用风险**: 恶意用户可能大量上传内容
3. **成本控制**: GitHub API有使用配额

#### 风险缓解
1. **速率限制**: 限制单IP使用频率
2. **监控报警**: 设置使用量监控
3. **Token轮换**: 定期更换Token
4. **使用条款**: 明确服务使用规则

### 🔄 Token管理

#### 定期轮换
建议每3-6个月更换一次Token：
1. 生成新的GitHub Token
2. 更新环境变量
3. 重新部署应用
4. 删除旧Token

#### 监控使用量
建议监控指标：
- API调用次数
- 失败率
- 异常IP访问模式
- 大文件上传频率

### 🚨 应急响应

#### Token泄露处理
如发现Token被滥用：
1. 立即在GitHub中删除Token
2. 生成新Token并更新部署
3. 检查Gist使用情况
4. 必要时联系GitHub支持

#### 服务中断
当默认服务不可用时：
- 用户可切换到自己的Token
- 或使用Base64 URL编码方式
- 确保服务可用性

### 💡 最佳实践

#### 用户教育
- 明确告知用户数据将上传到GitHub
- 提供隐私政策和使用条款
- 鼓励用户使用自己的Token

#### 透明度
- 开源代码，允许审计
- 明确说明数据处理方式
- 提供安全报告渠道

#### 备用方案
- 提供多种上传方式选择
- Base64编码作为备用方案
- 支持用户自定义Token

#### 一次性Token管理
- 仅在必要时生成分享链接
- 确保分享给可信任的人员
- 定期清理过期的Token记录
- 监控分享链接的使用情况

### 📞 联系方式

如发现安全问题，请通过以下方式联系：
- 邮箱: security@jsonme.dev
- GitHub Issue (标记为Security)
- 或通过项目维护者联系

---

**最后更新**: 2024年1月
**版本**: 1.0 